{% extends 'base.html' %}
{% block title %}Educator{% endblock %}
{% block body %}
{% load static %}
<script>
    
    var requireJS = [];
    loadJS(requireJS, "{% static 'dashboard/views/charts2.js'%}");
    
</script>
<script>
function loadReivews(event){
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            data = JSON.parse(this.responseText);
            
            
            document.getElementById("review_results").innerHTML="";
            var str ='';
            var counter = 1;
            for(var i = 0; i < data.reviews.length; i++){
                
                var id = data.reviews[i].student_id;
                var name = data.reviews[i].student__name;
                var cont = data.reviews[i].content;
                
                str+='<div class="media mb-4">';
                    if (data.reviews[i].is_anonymous){
                        
                        str+='<img class="d-flex mr-3 rounded-circle"';
                        str+=`src="{% static 'imgs/anonymous.png'%}" width="50" height="50"alt="">`;
                        str+='<div class="media-body">'
                        str+='<h5 class="mt-0" style="margin-bottom: 2px;">Anonymous</h5>';
                    }
                    else{
                        str+='<img class="d-flex mr-3 rounded-circle"';
                        str+=`src="{% static 'dashboard\img\profile-pictures.png'%}" width="50" height="50"alt="">`;
                        str+='<div class="media-body">';
                        str+='<h5 class="mt-0" style="margin-bottom: 2px;"><a id="a_'+counter+'" href="">'+name+'</a></h5>';
                        counter++;
                        }
                        str+='<p>'+cont+'</p>';
                        str+='<div class="btn-group btn-group-justified">';
                        str+='<button type="button" class="btn btn-link">Report Abuse</button>';
                        str+='</div>';

                    str+='</div>';
                    str+='</div>';

            }
        
            str += '<ul class="pagination" style="margin-top: 25px">';
            element = document.getElementById("total").value;
            for(var i = 1; i <= element; i++){
                str+='<li class="page-item" id="li_'+i+'"><a id="lis_'+i+'" class="page-link" href="#" onclick="loadReivews(event)" >1</a></li>';
            }
            str+="</ul></div>";
            document.getElementById("review_results").innerHTML = str;
            document.getElementById("li_"+data.num_pages).classList.add("active");
            
            for(var i = 0; i < data.reviews.length; i++){
                var element = document.getElementById("a_"+String(i+1));
                if(element){
                    element.href= "/educator/student/"+id;
                }
                }
        
    } 
    };
    var page = document.getElementById(event.target.id).innerHTML;
    
    xhttp.open("GET", "{% url 'dashboard:educator_reviews_paginator' %}?keyword="+page, true);
    
    xhttp.send();
}

</script>

    <input type="hidden" id="myVar" name="variable" readonly value="{{ educator_rating }}">
    <input type="hidden" id="total" name="variable" readonly value="{{ educator_reviews_num_pages }}">
    <main class="animated fadeIn row">

    <div class="card" style="margin-top: 10px">
        <div class="card-header">
            <h3 class="card-title mb-0">Strengths & Weakness</h3>
        </div>
        <div class="card-body">
            <div class="row col-md-2">

                <div class="input-group-btn col-md-6">
                    <button type="button" class="btn btn-light dropdown-toggle"
                            data-toggle="dropdown">Year
                        <span class="caret"></span>
                    </button>
                    <div class="dropdown-menu">
                        {% for year in educator_reviews_years %}
                            <a class="dropdown-item" href="#">{{ year.name }}</a>
                        {% endfor %}
                    </div>

                </div>
                <div class="input-group-btn col-md-6">
                  <button type="button" class="btn btn-light dropdown-toggle"
                            data-toggle="dropdown">Department
                            <span class="caret"></span>
                    </button>
                    <div class="dropdown-menu">
                        {% for dep in educator_reviews_departments %}
                            <a class="dropdown-item" href="#">{{ dep.name }}</a>
                        {% endfor %}
                   </div>
                    </div>

            </div>

            <div class="chart-wrapper" style="height: 70vh;width: 80vw;">
                <canvas id="canvas-1" class="chart"
                        style="height: inherit;"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="card" style="margin-top: 10px">
            <div class="card-header">
                <h3 class="card-title mb-0">Student Reviews</h3>
            </div>
            <div class="card-body" id="review_results">
                {%for rev in educator_reviews%}
                <div class="media mb-4">
                    {%if rev.is_anonymous%}
                    <img class="d-flex mr-3 rounded-circle"
                         src="{% static 'imgs/anonymous.png'%}" width="50" height="50"
                         alt="">
                    <div class="media-body">
                        <h5 class="mt-0" style="margin-bottom: 2px;">Anonymous</h5>
                    {%else%}
                    <img class="d-flex mr-3 rounded-circle"
                    src="{% static 'dashboard\img\profile-pictures.png'%}" width="50" height="50"
                    alt="">
                    <div class="media-body">
                        <h5 class="mt-0" style="margin-bottom: 2px;"><a href="{% url 'dashboard:educator_student_profile' rev.student_id %}">{{rev.student__name}}</a></h5>
                    
                    {%endif%}
                        <p>{{rev.content}}</p>
                        <div class="btn-group btn-group-justified">
                        <button type="button" class="btn btn-link">Report Abuse</button>
                        </div>

                    </div>
                </div>
                {%endfor%}
                <ul class="pagination" style="margin-top: 25px">
                        {% with ''|center:educator_reviews_num_pages as range %}
                        {% for i in range %}
                        <li class="page-item " >
                                <a id="lis_{{forloop.counter}}" class="page-link" href="#" onclick="loadReivews(event)" >{{forloop.counter}}</a>
                        </li>
                        {% endfor %}
                        {% endwith %}
                    
                </ul>
                
            </div>
        </div>

    </div>

</main>
{% endblock %}